<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Market Decision Maker - AI Investment Advisor</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js for portfolio visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            min-height: 100vh;
        }

        .glass-card {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.2);
        }

        .gradient-border {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            padding: 2px;
            border-radius: 12px;
        }

        .gradient-border > div {
            background: rgba(30, 41, 59, 0.95);
            border-radius: 10px;
        }

        .input-field {
            background: rgba(51, 65, 85, 0.8);
            border: 1px solid rgba(148, 163, 184, 0.3);
            transition: all 0.3s ease;
        }

        .input-field:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
        }

        .risk-low { color: #10b981; }
        .risk-moderate { color: #f59e0b; }
        .risk-high { color: #ef4444; }

        .loading-spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
    </style>
</head>
<body class="min-h-screen p-4">
    <!-- Header -->
    <header class="text-center mb-8">
        <div class="gradient-border mx-auto max-w-4xl">
            <div class="p-8">
                <h1 class="text-4xl md:text-5xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent mb-4">
                    Stock Market Decision Maker
                </h1>
                <p class="text-xl text-gray-300 mb-6">
                    AI-powered investment advisor to help you make smart stock market decisions
                </p>
                <div class="flex justify-center space-x-4">
                    <a href="/dashboard" class="inline-flex items-center px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                        </svg>
                        Back to Dashboard
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto">
        <!-- Input Form -->
        <div class="glass-card rounded-2xl p-6 mb-8">
            <h2 class="text-2xl font-semibold mb-6 text-center">Investment Parameters</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Investment Amount -->
                <div>
                    <label class="block text-sm font-medium mb-2">Investment Amount ($)</label>
                    <input type="number" id="investmentAmount" placeholder="10000" min="1000" step="1000" 
                           class="input-field w-full p-3 rounded-lg text-white placeholder-gray-400">
                </div>

                <!-- Expected Profit -->
                <div>
                    <label class="block text-sm font-medium mb-2">Expected Profit ($)</label>
                    <input type="number" id="expectedProfit" placeholder="1500" min="100" step="100" 
                           class="input-field w-full p-3 rounded-lg text-white placeholder-gray-400">
                </div>

                <!-- Risk Tolerance -->
                <div>
                    <label class="block text-sm font-medium mb-2">Risk Tolerance</label>
                    <select id="riskTolerance" class="input-field w-full p-3 rounded-lg text-white">
                        <option value="low">Low Risk</option>
                        <option value="moderate" selected>Moderate Risk</option>
                        <option value="high">High Risk</option>
                    </select>
                </div>

                <!-- Investment Horizon -->
                <div>
                    <label class="block text-sm font-medium mb-2">Investment Horizon</label>
                    <select id="investmentHorizon" class="input-field w-full p-3 rounded-lg text-white">
                        <option value="short">Short Term (1-3 years)</option>
                        <option value="medium" selected>Medium Term (3-7 years)</option>
                        <option value="long">Long Term (7+ years)</option>
                    </select>
                </div>

                <!-- Sector Preference -->
                <div>
                    <label class="block text-sm font-medium mb-2">Sector Preference</label>
                    <select id="sectorPreference" class="input-field w-full p-3 rounded-lg text-white">
                        <option value="any" selected>Any Sector</option>
                        <option value="tech">Technology</option>
                        <option value="finance">Financial Services</option>
                        <option value="healthcare">Healthcare</option>
                        <option value="energy">Energy</option>
                    </select>
                </div>

                <!-- Analyze Button -->
                <div class="md:col-span-2 lg:col-span-1 flex items-end">
                    <button id="analyzeBtn" class="btn-primary w-full py-3 px-6 rounded-lg text-white font-semibold">
                        Analyze Investment
                    </button>
                </div>
            </div>
        </div>

        <!-- Loading Indicator -->
        <div id="loading" class="hidden text-center py-12">
            <div class="loading-spinner w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"></div>
            <p class="text-lg text-gray-300">Analyzing your investment parameters...</p>
        </div>

        <!-- Results Section -->
        <div id="results" class="hidden space-y-8">
            <!-- Investment Summary -->
            <div class="glass-card rounded-2xl p-6">
                <h3 class="text-2xl font-semibold mb-6 text-center">Investment Summary</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="text-center p-4 bg-blue-900/20 rounded-lg">
                        <div class="text-3xl font-bold text-blue-400" id="expectedReturnRate">0%</div>
                        <div class="text-sm text-gray-400">Expected Return Rate</div>
                    </div>
                    <div class="text-center p-4 bg-purple-900/20 rounded-lg">
                        <div class="text-3xl font-bold text-purple-400" id="riskScore">0</div>
                        <div class="text-sm text-gray-400">Risk Score</div>
                    </div>
                    <div class="text-center p-4 bg-green-900/20 rounded-lg">
                        <div class="text-2xl font-bold text-green-400" id="riskLevel">Low</div>
                        <div class="text-sm text-gray-400">Risk Level</div>
                    </div>
                </div>
            </div>

            <!-- Company Recommendations -->
            <div class="glass-card rounded-2xl p-6">
                <h3 class="text-2xl font-semibold mb-6 text-center">Top Company Recommendations</h3>
                <div id="recommendationsList" class="space-y-4">
                    <!-- Recommendations will be populated here -->
                </div>
            </div>

            <!-- Portfolio Allocation -->
            <div class="glass-card rounded-2xl p-6">
                <h3 class="text-2xl font-semibold mb-6 text-center">Recommended Portfolio Allocation</h3>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div>
                        <div id="allocationChart" class="chart-container"></div>
                    </div>
                    <div class="space-y-4">
                        <div id="allocationDetails">
                            <!-- Allocation details will be populated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Market Analysis -->
            <div class="glass-card rounded-2xl p-6">
                <h3 class="text-2xl font-semibold mb-6 text-center">Market Analysis</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="text-lg font-semibold mb-3 text-green-400">Market Outlook</h4>
                        <p id="marketOutlook" class="text-gray-300 mb-4"></p>
                        
                        <h4 class="text-lg font-semibold mb-3 text-blue-400">Key Drivers</h4>
                        <ul id="keyDrivers" class="space-y-2 text-gray-300">
                            <!-- Key drivers will be populated here -->
                        </ul>
                    </div>
                    <div>
                        <h4 class="text-lg font-semibold mb-3 text-yellow-400">Risks</h4>
                        <ul id="marketRisks" class="space-y-2 text-gray-300">
                            <!-- Market risks will be populated here -->
                        </ul>
                        
                        <h4 class="text-lg font-semibold mb-3 text-purple-400">Opportunities</h4>
                        <ul id="opportunities" class="space-y-2 text-gray-300">
                            <!-- Opportunities will be populated here -->
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Risk Assessment -->
            <div class="glass-card rounded-2xl p-6">
                <h3 class="text-2xl font-semibold mb-6 text-center">Risk Assessment & Mitigation</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="text-lg font-semibold mb-3 text-red-400">Risk Factors</h4>
                        <ul id="riskFactors" class="space-y-2 text-gray-300">
                            <!-- Risk factors will be populated here -->
                        </ul>
                    </div>
                    <div>
                        <h4 class="text-lg font-semibold mb-3 text-green-400">Mitigation Strategies</h4>
                        <ul id="mitigationStrategies" class="space-y-2 text-gray-300">
                            <!-- Mitigation strategies will be populated here -->
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Error Message -->
        <div id="errorMsg" class="hidden glass-card rounded-2xl p-6 border border-red-500">
            <div class="text-center">
                <div class="text-red-400 text-6xl mb-4">⚠️</div>
                <h3 class="text-xl font-semibold text-red-400 mb-2">Analysis Error</h3>
                <p id="errorText" class="text-gray-300"></p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const analyzeBtn = document.getElementById('analyzeBtn');
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            const errorMsg = document.getElementById('errorMsg');
            const errorText = document.getElementById('errorText');

            analyzeBtn.addEventListener('click', analyzeInvestment);

            async function analyzeInvestment() {
                const investmentAmount = parseFloat(document.getElementById('investmentAmount').value);
                const expectedProfit = parseFloat(document.getElementById('expectedProfit').value);
                const riskTolerance = document.getElementById('riskTolerance').value;
                const investmentHorizon = document.getElementById('investmentHorizon').value;
                const sectorPreference = document.getElementById('sectorPreference').value;

                // Validation
                if (!investmentAmount || !expectedProfit) {
                    showError('Please enter both investment amount and expected profit.');
                    return;
                }

                if (investmentAmount < 1000) {
                    showError('Investment amount must be at least $1,000.');
                    return;
                }

                if (expectedProfit <= 0) {
                    showError('Expected profit must be greater than $0.');
                    return;
                }

                // Show loading
                loading.classList.remove('hidden');
                results.classList.add('hidden');
                errorMsg.classList.add('hidden');

                try {
                    const response = await fetch('/analyze_investment', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            investment_amount: investmentAmount,
                            expected_profit: expectedProfit,
                            risk_tolerance: riskTolerance,
                            investment_horizon: investmentHorizon,
                            sector_preference: sectorPreference
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || 'Analysis failed');
                    }

                    const result = await response.json();
                    const data = JSON.parse(result.data);
                    
                    displayResults(data);
                    
                } catch (error) {
                    console.error('Error:', error);
                    showError(`Analysis failed: ${error.message}`);
                } finally {
                    loading.classList.add('hidden');
                }
            }

            function displayResults(data) {
                // Update summary
                document.getElementById('expectedReturnRate').textContent = `${data.investment_summary.expected_return_rate}%`;
                document.getElementById('riskScore').textContent = Math.round(data.investment_summary.risk_score);
                document.getElementById('riskLevel').textContent = data.risk_assessment.risk_level;

                // Update recommendations
                displayRecommendations(data.recommendations);

                // Update portfolio allocation
                displayPortfolioAllocation(data.portfolio_allocation);

                // Update market analysis
                displayMarketAnalysis(data.market_analysis);

                // Update risk assessment
                displayRiskAssessment(data.risk_assessment);

                // Show results
                results.classList.remove('hidden');
                results.classList.add('fade-in');
            }

            function displayRecommendations(recommendations) {
                const container = document.getElementById('recommendationsList');
                container.innerHTML = '';

                recommendations.forEach(company => {
                    const riskClass = `risk-${company.risk_level}`;
                    const card = document.createElement('div');
                    card.className = 'glass-card rounded-lg p-4 border-l-4 border-blue-500';
                    card.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="text-lg font-semibold text-white">${company.name}</h4>
                            <span class="px-2 py-1 rounded text-xs font-medium ${riskClass}">
                                ${company.risk_level.toUpperCase()} RISK
                            </span>
                        </div>
                        <p class="text-sm text-gray-400 mb-2">${company.sector}</p>
                        <p class="text-sm text-blue-400 mb-2">Expected Return: ${company.expected_return}</p>
                        <p class="text-sm text-gray-300">${company.reasoning}</p>
                    `;
                    container.appendChild(card);
                });
            }

            function displayPortfolioAllocation(allocation) {
                const detailsContainer = document.getElementById('allocationDetails');
                detailsContainer.innerHTML = `
                    <div class="space-y-3">
                        <div class="flex justify-between items-center p-3 bg-blue-900/20 rounded-lg">
                            <span class="text-white">Stocks</span>
                            <span class="text-blue-400 font-semibold">${allocation.stocks}%</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-green-900/20 rounded-lg">
                            <span class="text-white">Bonds</span>
                            <span class="text-green-400 font-semibold">${allocation.bonds}%</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-purple-900/20 rounded-lg">
                            <span class="text-white">Cash</span>
                            <span class="text-purple-400 font-semibold">${allocation.cash}%</span>
                        </div>
                        <p class="text-sm text-gray-400 mt-4">${allocation.reasoning}</p>
                    </div>
                `;

                // Create pie chart
                createPieChart(allocation);
            }

            function createPieChart(allocation) {
                const ctx = document.createElement('canvas');
                ctx.id = 'allocationChartCanvas';
                document.getElementById('allocationChart').innerHTML = '';
                document.getElementById('allocationChart').appendChild(ctx);

                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Stocks', 'Bonds', 'Cash'],
                        datasets: [{
                            data: [allocation.stocks, allocation.bonds, allocation.cash],
                            backgroundColor: ['#3b82f6', '#10b981', '#8b5cf6'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: '#e2e8f0',
                                    font: {
                                        size: 14
                                    }
                                }
                            }
                        }
                    }
                });
            }

            function displayMarketAnalysis(analysis) {
                document.getElementById('marketOutlook').textContent = analysis.overall_market;
                
                populateList('keyDrivers', analysis.key_drivers);
                populateList('marketRisks', analysis.risks);
                populateList('opportunities', analysis.opportunities);
            }

            function displayRiskAssessment(assessment) {
                populateList('riskFactors', assessment.risk_factors);
                populateList('mitigationStrategies', assessment.mitigation_strategies);
            }

            function populateList(elementId, items) {
                const container = document.getElementById(elementId);
                container.innerHTML = '';
                
                items.forEach(item => {
                    const li = document.createElement('li');
                    li.className = 'flex items-start';
                    li.innerHTML = `
                        <span class="text-blue-400 mr-2">•</span>
                        <span>${item}</span>
                    `;
                    container.appendChild(li);
                });
            }

            function showError(message) {
                errorText.textContent = message;
                errorMsg.classList.remove('hidden');
                results.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
