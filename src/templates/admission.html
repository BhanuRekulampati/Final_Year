{% extends 'base.html' %}
{% block title %}College Admission Advisor | AI Decision Platform{% endblock %}
{% block content %}
<style>
    .result-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        font-size: 0.9rem;
        background: #fff;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        border-radius: 8px;
        overflow: hidden;
    }
    .result-table th, .result-table td {
        border: 1px solid #e0e0e0;
        padding: 12px 10px;
        text-align: left;
        vertical-align: top;
    }
    .result-table th {
        background: #f4f6f8;
        font-weight: 600;
        color: #333;
    }
    .result-table tr:nth-child(even) {
        background: #f9fafb;
    }
    .result-table tr:hover {
        background: #f0f8ff;
    }
    .form-container {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 20px;
        margin-bottom: 30px;
    }
    .form-section {
        background: #fff;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        border: 1px solid #e0e0e0;
    }
    .summary-section {
        background: #f8f9fa;
        padding: 25px;
        border-radius: 12px;
        border: 2px solid #e9ecef;
        height: fit-content;
    }
    .form-group {
        margin-bottom: 20px;
    }
    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #2c3e50;
    }
    .form-input {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.3s ease;
    }
    .form-input:focus {
        outline: none;
        border-color: #3498db;
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }
    .submit-btn {
        width: 100%;
        padding: 15px;
        background: linear-gradient(135deg, #3498db, #2980b9);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 18px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    .submit-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
    }
    .nav-tabs {
        display: flex;
        justify-content: center;
        margin-bottom: 30px;
        background: #f8f9fa;
        padding: 10px;
        border-radius: 12px;
        flex-wrap: wrap;
    }
    .nav-tab {
        padding: 12px 25px;
        text-decoration: none;
        border-radius: 8px;
        font-weight: 600;
        margin: 0 10px;
        transition: all 0.3s ease;
        white-space: nowrap;
    }
    .nav-tab.active {
        background: linear-gradient(135deg, #3498db, #2980b9);
        color: white;
        box-shadow: 0 2px 8px rgba(52, 152, 219, 0.3);
    }
    .nav-tab.inactive {
        background: #fff;
        color: #2c3e50;
        border: 2px solid #3498db;
    }
    .nav-tab:hover {
        transform: translateY(-1px);
    }
    @media (max-width: 1200px) {
        .form-container {
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .form-section {
            grid-column: span 1;
        }
        .summary-section {
            grid-column: span 1;
        }
    }
    @media (max-width: 768px) {
        .form-container {
            grid-template-columns: 1fr;
            gap: 20px;
        }
        .form-section, .summary-section {
            grid-column: span 1;
        }
        .nav-tabs {
            flex-direction: column;
            align-items: center;
        }
        .nav-tab {
            margin: 5px 0;
            width: 100%;
            text-align: center;
        }
        .result-table {
            font-size: 0.8rem;
        }
        .result-table th, .result-table td {
            padding: 8px 6px;
        }
        .form-section, .summary-section {
            padding: 20px;
        }
    }
</style>

<div class="container" style="max-width: 100%; padding: 0 20px;">
    <h1 style="text-align: center; color: #2c3e50; margin-bottom: 30px; font-size: 2.5em;">üéì College Admission Advisor</h1>
    
    <!-- Navigation Tabs -->
    <div class="nav-tabs">
        <a href="{{ url_for('admission') }}" class="nav-tab active">
            üöÄ Get Admission Advice
        </a>
        <a href="{{ url_for('colleges') }}" class="nav-tab inactive">
            üè´ Browse All Colleges
        </a>
    </div>
    
    <div class="form-container" style="grid-template-columns: 1fr; gap: 20px; max-width: 600px; margin: 0 auto;">
        <!-- Form Section -->
        <div class="form-section" style="grid-column: span 1;">
            <h2 style="color: #34495e; margin-bottom: 20px; border-bottom: 2px solid #3498db; padding-bottom: 10px; text-align: center;">üìù Enter Your Details</h2>
            
            <form method="POST">
                <div class="form-group">
                    <label for="marks">üìä EAMCET Marks</label>
                    <input type="number" id="marks" name="marks" min="0" max="160" step="0.1" required 
                           placeholder="Enter your EAMCET marks (0-160)" 
                           value="{{ form_data.marks if form_data.marks else '' }}"
                           class="form-input">
                </div>
                <div class="form-group">
                    <label for="degree">üéØ Degree to Join</label>
                    <select id="degree" name="degree" required class="form-input">
                        <option value="B.Tech" {% if form_data.degree == 'B.Tech' %}selected{% endif %}>B.Tech</option>
                        <option value="B.Sc" {% if form_data.degree == 'B.Sc' %}selected{% endif %}>B.Sc</option>
                        <option value="B.Com" {% if form_data.degree == 'B.Com' %}selected{% endif %}>B.Com</option>
                        <option value="BA" {% if form_data.degree == 'BA' %}selected{% endif %}>BA</option>
                        <option value="MBBS" {% if form_data.degree == 'MBBS' %}selected{% endif %}>MBBS</option>
                        <option value="BBA" {% if form_data.degree == 'BBA' %}selected{% endif %}>BBA</option>
                        <option value="Law" {% if form_data.degree == 'Law' %}selected{% endif %}>Law</option>
                        <option value="Other" {% if form_data.degree == 'Other' %}selected{% endif %}>Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="stream">üî¨ Main Stream</label>
                    <select id="stream" name="stream" required class="form-input">
                        <option value="">Select Main Stream</option>
                        <option value="Engineering" {% if form_data.stream == 'Engineering' %}selected{% endif %}>Engineering</option>
                        <option value="Arts" {% if form_data.stream == 'Arts' %}selected{% endif %}>Arts</option>
                        <option value="Commerce" {% if form_data.stream == 'Commerce' %}selected{% endif %}>Commerce</option>
                        <option value="Science" {% if form_data.stream == 'Science' %}selected{% endif %}>Science</option>
                        <option value="Medical" {% if form_data.stream == 'Medical' %}selected{% endif %}>Medical</option>
                        <option value="Law" {% if form_data.stream == 'Law' %}selected{% endif %}>Law</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="sub_course">üìö Sub-Course</label>
                    <select id="sub_course" name="sub_course" required class="form-input">
                        <option value="">Select Main Stream First</option>
                        {% if form_data.sub_course %}
                            <option value="{{ form_data.sub_course }}" selected>{{ form_data.sub_course }}</option>
                        {% endif %}
                    </select>
                </div>
                <div class="form-group">
                    <label for="caste">üë• Caste Category</label>
                    <select id="caste" name="caste" required class="form-input">
                        <option value="OC" {% if form_data.caste == 'OC' %}selected{% endif %}>OC (Open Category)</option>
                        <option value="BC" {% if form_data.caste == 'BC' %}selected{% endif %}>BC (Backward Class)</option>
                        <option value="SC" {% if form_data.caste == 'SC' %}selected{% endif %}>SC (Scheduled Caste)</option>
                        <option value="ST" {% if form_data.caste == 'ST' %}selected{% endif %}>ST (Scheduled Tribe)</option>
                        <option value="EWS" {% if form_data.caste == 'EWS' %}selected{% endif %}>EWS (Economically Weaker Section)</option>
                        <option value="Other" {% if form_data.caste == 'Other' %}selected{% endif %}>Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="sex">üöª Sex</label>
                    <select id="sex" name="sex" required class="form-input">
                        <option value="Male" {% if form_data.sex == 'Male' %}selected{% endif %}>Male</option>
                        <option value="Female" {% if form_data.sex == 'Female' %}selected{% endif %}>Female</option>
                        <option value="Other" {% if form_data.sex == 'Other' %}selected{% endif %}>Other</option>
                    </select>
                </div>
                <button type="submit" class="submit-btn" onclick="showSummary()">üöÄ Get Admission Advice</button>
            </form>
            
            <!-- Quick Tips Section -->
            <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #3498db;">
                <h3 style="color: #2c3e50; margin-bottom: 12px; font-size: 1.1em;">üí° Quick Tips</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; font-size: 13px;">
                    <div>
                        <h4 style="color: #e67e22; margin-bottom: 6px; font-size: 0.9em;">üìä EAMCET Marks</h4>
                        <div style="font-size: 12px; color: #555;">
                            <div style="margin-bottom: 8px;">
                                <strong style="color: #e67e22;">General Category (OC):</strong>
                                <ul style="margin: 5px 0 0 15px; padding-left: 15px;">
                                    <li>90+ marks: Top tier colleges</li>
                                    <li>80-89 marks: Mid tier colleges</li>
                                    <li>70-79 marks: Lower tier colleges</li>
                                    <li>Below 70: Consider alternatives</li>
                                </ul>
                            </div>
                            <div style="margin-bottom: 8px;">
                                <strong style="color: #27ae60;">Reserved Categories:</strong>
                                <ul style="margin: 5px 0 0 15px; padding-left: 15px;">
                                    <li>BC/SC/ST/EWS: Lower marks may qualify</li>
                                    <li>Check specific college requirements</li>
                                    <li>Reservation benefits apply</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h4 style="color: #27ae60; margin-bottom: 6px; font-size: 0.9em;">üéØ Category Benefits</h4>
                        <ul style="margin: 0; padding-left: 15px; color: #555;">
                            <li><strong>BC:</strong> 25% reservation</li>
                            <li><strong>SC:</strong> 15% reservation</li>
                            <li><strong>ST:</strong> 6% reservation</li>
                            <li><strong>EWS:</strong> 10% reservation</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Results Section (Hidden by default, shown after form submission) -->
    <div id="results-section" style="display: none; margin-top: 30px;">
        <div class="form-container" style="grid-template-columns: 1fr 1fr; gap: 20px;">
            <!-- Summary Section -->
            <div class="summary-section" style="grid-column: span 1;">
                <h2 style="color: #34495e; margin-bottom: 20px; border-bottom: 2px solid #27ae60; padding-bottom: 10px;">üìã Your Details Summary</h2>
                <div id="summary" style="font-size: 16px; line-height: 1.6;">
                    <p style="color: #7f8c8d; font-style: italic;">Complete all fields and click "Get Admission Advice" to see your details...</p>
                </div>
            </div>
            
            <!-- Additional Info Section -->
            <div class="summary-section" style="grid-column: span 1;">
                <div class="quick-tips-header" style="cursor: pointer; padding: 6px 10px; background: linear-gradient(135deg, #e67e22, #d35400); color: white; border-radius: 4px; margin-bottom: 0; display: flex; justify-content: space-between; align-items: center; width: fit-content; margin-left: auto;" onclick="toggleQuickTips()">
                    <h2 style="color: white; margin: 0; font-size: 0.9em;">üí° Quick Tips</h2>
                    <span id="quick-tips-icon" style="font-size: 1em; transition: transform 0.3s ease;">‚ñº</span>
                </div>
                <div id="quick-tips-content" style="font-size: 13px; line-height: 1.4; display: none;">
                    <div style="background: #fff3cd; padding: 8px; border-radius: 6px; border-left: 3px solid #f39c12; margin-bottom: 8px;">
                        <div style="color: #856404; font-weight: 600; margin-bottom: 4px;">üìä Marks Guide:</div>
                        <div style="color: #856404; font-size: 12px;">
                            <span style="color: #e67e22; font-weight: 600;">90+</span> Top | 
                            <span style="color: #e67e22; font-weight: 600;">80-89</span> Mid | 
                            <span style="color: #e67e22; font-weight: 600;">70-79</span> Lower | 
                            <span style="color: #e67e22; font-weight: 600;">Below 70</span> Alternative
                        </div>
                    </div>
                    <div style="background: #e8f5e8; padding: 8px; border-radius: 6px; border-left: 3px solid #27ae60; margin-bottom: 8px;">
                        <div style="color: #27ae60; font-weight: 600; margin-bottom: 4px;">üéØ Categories:</div>
                        <div style="color: #27ae60; font-size: 12px;">
                            <span style="color: #2e7d32; font-weight: 600;">BC</span> 25% | 
                            <span style="color: #2e7d32; font-weight: 600;">SC</span> 15% | 
                            <span style="color: #2e7d32; font-weight: 600;">ST</span> 6% | 
                            <span style="color: #2e7d32; font-weight: 600;">EWS</span> 10%
                        </div>
                    </div>
                    <div style="background: #e3f2fd; padding: 8px; border-radius: 6px; border-left: 3px solid #2196f3;">
                        <div style="color: #1976d2; font-weight: 600; margin-bottom: 4px;">üè´ Popular:</div>
                        <div style="color: #1976d2; font-size: 12px;">
                            <span style="color: #1565c0; font-weight: 600;">Engineering</span> CSE/ECE | 
                            <span style="color: #1565c0; font-weight: 600;">Medical</span> MBBS | 
                            <span style="color: #1565c0; font-weight: 600;">Commerce</span> BCom/BBA
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- JavaScript for real-time summary update -->
    <script>
        // Sub-course options for each main stream
        const subCourses = {
            'Engineering': ['CSE', 'ECE', 'Mechanical', 'Civil', 'Electrical', 'IT', 'EEE'],
            'Arts': ['BA English', 'BA History', 'BA Political Science', 'BA Economics', 'BA Sociology'],
            'Commerce': ['BCom General', 'BCom Computers', 'BCom Finance', 'BCom Marketing', 'BBA'],
            'Science': ['BSc Physics', 'BSc Chemistry', 'BSc Mathematics', 'BSc Biology', 'BSc Computer Science'],
            'Medical': ['MBBS', 'BDS', 'BAMS', 'BHMS', 'BSc Nursing'],
            'Law': ['LLB', 'BA LLB', 'BBA LLB', 'BCom LLB']
        };

        function updateSubCourses() {
            const streamSelect = document.getElementById('stream');
            const subCourseSelect = document.getElementById('sub_course');
            const selectedStream = streamSelect.value;
            
            // Clear existing options
            subCourseSelect.innerHTML = '<option value="">Select Sub-Course</option>';
            
            if (selectedStream && subCourses[selectedStream]) {
                subCourses[selectedStream].forEach(course => {
                    const option = document.createElement('option');
                    option.value = course;
                    option.textContent = course;
                    subCourseSelect.appendChild(option);
                });
            }
            
            updateSummary();
        }

        function updateSummary() {
            const marks = document.getElementById('marks').value;
            const degree = document.getElementById('degree').value;
            const stream = document.getElementById('stream').value;
            const sub_course = document.getElementById('sub_course').value;
            const caste = document.getElementById('caste').value;
            const sex = document.getElementById('sex') ? document.getElementById('sex').value : '';
            
            const summaryDiv = document.getElementById('summary');
            
            // Only show summary if all fields are filled
            if (marks && degree && stream && sub_course && caste && sex) {
                let summaryHTML = '<div style="background: #e8f5e8; padding: 15px; border-radius: 8px; border-left: 4px solid #27ae60;">';
                summaryHTML += '<h3 style="color: #27ae60; margin-bottom: 15px;">üìã Your Entered Details:</h3>';
                
                summaryHTML += `<p><strong>üìä EAMCET Marks:</strong> ${marks}/160</p>`;
                summaryHTML += `<p><strong>üéØ Degree:</strong> ${degree}</p>`;
                summaryHTML += `<p><strong>üî¨ Main Stream:</strong> ${stream}</p>`;
                summaryHTML += `<p><strong>üìö Sub-Course:</strong> ${sub_course}</p>`;
                summaryHTML += `<p><strong>üë• Category:</strong> ${caste}</p>`;
                summaryHTML += `<p><strong>üöª Sex:</strong> ${sex}</p>`;
                
                summaryHTML += '</div>';
                summaryDiv.innerHTML = summaryHTML;
                summaryDiv.style.display = 'block';
            } else {
                summaryDiv.innerHTML = '<p style="color: #7f8c8d; font-style: italic;">Complete all fields and click "Get Admission Advice" to see your details...</p>';
                summaryDiv.style.display = 'none';
            }
        }
        
        // Add event listeners to form fields
        document.addEventListener('DOMContentLoaded', function() {
            const formFields = ['marks', 'degree', 'stream', 'sub_course', 'caste', 'sex'];
            formFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    // Remove automatic summary updates
                    // field.addEventListener('input', updateSummary);
                    // field.addEventListener('change', updateSummary);
                }
            });
            
            // Add event listener for stream selection to update sub-courses
            const streamSelect = document.getElementById('stream');
            if (streamSelect) {
                streamSelect.addEventListener('change', updateSubCourses);
            }
            
            // Don't show summary on page load
            // updateSummary();
            updateSubCourses();
        });

        // Function to toggle Quick Tips section
        function toggleQuickTips() {
            const content = document.getElementById('quick-tips-content');
            const icon = document.getElementById('quick-tips-icon');
            
            if (content.style.display === 'none' || content.style.display === '') {
                content.style.display = 'block';
                icon.style.transform = 'rotate(180deg)';
                icon.textContent = '‚ñ≤';
            } else {
                content.style.display = 'none';
                icon.style.transform = 'rotate(0deg)';
                icon.textContent = '‚ñº';
            }
        }

        // Function to show summary after form submission
        function showSummary() {
            const marks = document.getElementById('marks').value;
            const degree = document.getElementById('degree').value;
            const stream = document.getElementById('stream').value;
            const sub_course = document.getElementById('sub_course').value;
            const caste = document.getElementById('caste').value;
            const sex = document.getElementById('sex') ? document.getElementById('sex').value : '';
            
            // Only show results if all fields are filled
            if (marks && degree && stream && sub_course && caste && sex) {
                const resultsSection = document.getElementById('results-section');
                resultsSection.style.display = 'block';
                updateSummary();
            }
        }
    </script>
    
    {% if result %}
    <div class="result" style="margin-top:30px; padding:20px; background:#f8f9fa; border-radius:10px; border:1px solid #e9ecef;">
        {% if result.colleges %}
        <div style="margin-bottom:20px; font-size:1.2em; color:#1a237e; padding:15px; background:#e3f2fd; border-radius:8px; border-left:4px solid #2196f3;">
            <b>üéØ Predicted EAMCET Rank Range:</b> {{ result.predicted_rank_range }} (Category: {{ result.caste }})
        </div>
        
        {% if result.colleges and result.colleges[0].qualification_status == "Not Qualified" %}
        <div style="margin-bottom:20px; padding:15px; background:#ffebee; border-radius:8px; border-left:4px solid #f44336;">
            <h3 style="color:#c62828; margin-bottom:10px;">üö® IMPORTANT: You Don't Qualify for These Colleges</h3>
            <p style="color:#d32f2f; margin-bottom:8px;"><strong>Your Marks:</strong> {{ form_data.marks }}/160</p>
            <p style="color:#d32f2f; margin-bottom:8px;"><strong>Your Rank:</strong> {{ result.predicted_rank }}</p>
            <p style="color:#d32f2f;"><strong>Issue:</strong> Your marks are below the minimum requirement for these colleges.</p>
        </div>
        {% endif %}
        <h3 style="margin-top:20px; color:#2c3e50; border-bottom:2px solid #3498db; padding-bottom:10px;">üè´ College Suggestions (Sorted by Admission Chance)</h3>
        <div style="margin-bottom:10px; color:#e67e22; font-weight:600; font-size:1.05em;">
            <span title="You must have at least this many marks to be eligible for admission in the college.">‚ÑπÔ∏è <b>Note:</b> <u>Min Marks</u> is the minimum required to get admission in each college.</span>
        </div>
        <table class="result-table">
            <tr>
                <th>College</th>
                <th>Location</th>
                <th>Status</th>
                <th>Min Rank</th>
                <th style="color:#e67e22;">Min Marks <span title="Minimum marks required for admission.">?</span></th>
                <th>Avg Package</th>
                <th>Placement %</th>
                <th>Admission Chance</th>
                <th>Score</th>
            </tr>
            {% for college in result.colleges %}
            <tr{% if college.qualification_status == "Qualified" %} style="background:#f1f8e9;"{% else %} style="background:#fff3e0;"{% endif %}>
                <td>
                  {{ college.name }}
                  {% if college.admission_chance >= 60 %}<span style="color:#388e3c; font-size:0.95em; font-weight:700; margin-left:8px;">‚úÖ High Chance</span>{% elif college.admission_chance >= 40 %}<span style="color:#f57c00; font-size:0.95em; font-weight:700; margin-left:8px;">‚ö†Ô∏è Moderate</span>{% else %}<span style="color:#d32f2f; font-size:0.95em; font-weight:700; margin-left:8px;">‚ùå Low Chance</span>{% endif %}
                  {% if college.qualification_status == "Qualified" %}
                    {% if college.qualifies_by_rank and college.qualifies_by_marks %}<span style="color:#1976d2; font-size:0.9em; margin-left:8px;">‚úÖ Rank & Marks</span>{% elif college.qualifies_by_rank %}<span style="color:#388e3c; font-size:0.9em; margin-left:8px;">‚úÖ Rank</span>{% endif %}
                  {% endif %}
                </td>
                <td>{{ college.location }}</td>
                <td>
                    {% if college.qualification_status == "Qualified" %}
                        <span style="color:#388e3c; font-weight:600;">‚úÖ Qualified</span>
                    {% else %}
                        <span style="color:#d32f2f; font-weight:600;">‚ùå Not Qualified</span>
                    {% endif %}
                </td>
                <td>{{ college.min_rank if 'min_rank' in college else 'N/A' }}</td>
                <td style="font-weight:600; text-align:center; color:#e67e22;">
                  {% if 'min_marks' in college %}
                    {{ college.min_marks }}
                  {% else %}
                    N/A
                  {% endif %}
                </td>
                <td>{{ college.avg_package if 'avg_package' in college else 'N/A' }}</td>
                <td>
                    {% if college.placement_years %}
                        {{ college.placement_years.split(',')[0].split(':')[1].strip() if ':' in college.placement_years else 'N/A' }}
                    {% else %}
                        {{ college.placement.split(',')[1].strip() if ',' in college.placement else 'N/A' }}
                    {% endif %}
                </td>
                <td style="font-weight:600; text-align:center;">
                    {% if college.admission_chance >= 80 %}
                        <span style="color:#2e7d32; font-weight:700;">{{ college.admission_chance }}%</span>
                        <br><small style="color:#2e7d32;">Very High</small>
                    {% elif college.admission_chance >= 60 %}
                        <span style="color:#388e3c; font-weight:700;">{{ college.admission_chance }}%</span>
                        <br><small style="color:#388e3c;">High</small>
                    {% elif college.admission_chance >= 40 %}
                        <span style="color:#f57c00; font-weight:700;">{{ college.admission_chance }}%</span>
                        <br><small style="color:#f57c00;">Moderate</small>
                    {% elif college.admission_chance >= 20 %}
                        <span style="color:#d32f2f; font-weight:700;">{{ college.admission_chance }}%</span>
                        <br><small style="color:#d32f2f;">Low</small>
                    {% else %}
                        <span style="color:#c62828; font-weight:700;">{{ college.admission_chance }}%</span>
                        <br><small style="color:#c62828;">Very Low</small>
                    {% endif %}
                </td>
                <td style="font-weight:600; {% if college.qualification_status == 'Qualified' %}color:#2e7d32;{% else %}color:#d32f2f;{% endif %}">{{ college.score|round|int }}</td>
            </tr>
            {% endfor %}
        </table>
        {% if result.colleges and result.colleges[0].qualification_status == "Not Qualified" %}
        <div style="margin-top: 20px; padding: 15px; background: #ffebee; border-radius: 8px; border-left: 4px solid #f44336;">
            <h4 style="color: #c62828; margin-bottom: 10px;">‚ö†Ô∏è Qualification Alert:</h4>
            <div style="color: #d32f2f; margin-bottom: 15px;">
                <p><strong>Your EAMCET Marks: {{ form_data.marks }}/160</strong></p>
                <p><strong>Your Predicted Rank: {{ result.predicted_rank }}/{{ result.predicted_rank_range }}</strong></p>
                <p><strong>Category: {{ result.caste }}</strong></p>
            </div>
            <div style="background: #fff3e0; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
                <h5 style="color: #e65100; margin-bottom: 8px;">üìä Why You're Not Qualified:</h5>
                <ul style="color: #bf360c; margin: 0; padding-left: 20px;">
                    {% set lowest_marks = result.colleges|map(attribute='min_marks')|min %}
                    {% set lowest_rank = result.colleges|selectattr('min_rank')|map(attribute='min_rank')|min %}
                    <li><strong>Minimum Marks Required:</strong> {{ lowest_marks }} (You have: {{ form_data.marks }})</li>
                    {% if lowest_rank %}
                    <li><strong>Best Rank Required:</strong> {{ lowest_rank }} (Your predicted: {{ result.predicted_rank }})</li>
                    {% endif %}
                    <li><strong>Gap Analysis:</strong> You need {{ lowest_marks - form_data.marks|int }} more marks to qualify</li>
                </ul>
            </div>
            <div style="background: #e8f5e8; padding: 10px; border-radius: 5px;">
                <h5 style="color: #2e7d32; margin-bottom: 8px;">üí° How to Qualify:</h5>
                <ul style="color: #1b5e20; margin: 0; padding-left: 20px;">
                    <li><strong>Improve EAMCET Score:</strong> Aim for at least {{ lowest_marks }} marks</li>
                    <li><strong>Better Preparation:</strong> Focus on weak subjects and practice more</li>
                    <li><strong>Consider Lower Colleges:</strong> Look for colleges with marks requirement ‚â§ {{ form_data.marks }}</li>
                    <li><strong>Alternative Pathways:</strong> Explore management quota or other admission methods</li>
                    <li><strong>Next Year:</strong> Prepare better for next year's EAMCET</li>
                </ul>
            </div>
        </div>
        {% endif %}
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %} 